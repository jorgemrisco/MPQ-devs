<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideosTeste</title>
    <link rel="stylesheet" href="../css-styles/index.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,600;1,200;1,300&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css-styles/videos.css">
</head>
<body>
    <section id = "menu-bar">
        
        <div id="responsive-div">
            <div id="menu-logo">
                <a href="index.html">
                    <img id="logo-reference" src="../assets/images/logo/MPQ-logo-black.png" alt="MPQ-logo-black" height="60px">
                </a>
    </div>
    
        <div id="menu-links">
            <a class="nav-button" href="index.html#quem-somos">Quem Somos?</a>
            <a class="nav-button" href="index.html#listOfMembers">Nossa Equipe</a>
            <a class="nav-button" href="expo.html">Exposições</a>
            <a class="nav-button" href="acervo.html">Acervo</a>
            <a class="nav-button" href="mpqrecomenda.html">MPQ Recomenda</a>
            <a class="nav-button" href="http://www.enactus.org.br/" target="_blank">Enactus</a>
            <a class="nav-button" href="index.html#faleConosco">Fale Conosco</a>
            
        </div>
    </div>
    </section>
    
   <div class="container">
       <header>
            <h1>Playlist de Vídeos</h1>
       </header>
       
       <main id="main">
           
            <!--<div class="content">--><!--Video padrão antes de processar a API-->
                <!--<section id="videoMain"> 
                    <iframe width=80% height="315" src="https://www.youtube.com/embed/9sWEecNUW-o" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </section>
            </div>-->
           

             <script>
                 var apiKey = "AIzaSyDcOMLj0YjBJYjg_RwrTw2jWgeSeJhMH1g"; //inserido apos o key=
                 var playlistId = "PLGgUY89Rg0HxK-pbEjuB5fpv8f1gyZcgm"; //pode e deve ser alterado conforme necessidade
                 var url = "https://www.googleapis.com/youtube/v3/playlistItems";
                 var urlTeste = "https://www.googleapis.com/youtube/v3/playlistItems/?key=AIzaSyDcOMLj0YjBJYjg_RwrTw2jWgeSeJhMH1g&maxResults=4&part=snippet&playlistId=PLHNLKeG6BVcrtPP0PsDabY4WFVVX6XBbV";

                /* Só funciona usando jQuery, não sei utilizar pelo requerimento de js vanilla
                 var myInit = {
                     part : "snippet",
                     key : apiKey,
                     maxResults : 10,
                     playlistId : playlistId
                 };
                 */

                 function addClass(el, klass) {
                    el.classList.add(klass);
                 }

                 function removeClass(el, klass) {
                    el.classList.remove(klass);
                 }
                 
                 loadVideos();

                 async function loadVideos(){ /* comunicação com a API utilizando método await para o fetch*/
                     try{
                         let response = await fetch(urlTeste);
                         let dataJSON = await response.json();
                         //console.log(dataJSON);
                         var id = dataJSON.items[3].snippet.resourceId.videoId;
                         //mainVid(id);
                         subVideosLoop(dataJSON);
                     } catch(error) {
                         console.log("error", error);
                     }
                 }

                 function mainVid(id){ /* gera e atualiza o vídeo principal, futuramente será excluído, funciona mais como um debugger */
                     var novoVideo = document.getElementById("videoMain")
                     novoVideo.innerHTML = '<iframe width=100% height="315" src="https://www.youtube.com/embed/' + id +'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
                     //console.log(novoVideo.innerHTML);
                 }

                 function subVideosLoop(dataJSON){ //loop principal

                    var i;
                    for (i=0; i < dataJSON.items.length; i++){
                        var thumbnail = dataJSON.items[i].snippet.thumbnails.medium.url;
                        var title = dataJSON.items[i].snippet.title;
                        var descript = dataJSON.items[i].snippet.description.substring(0, 100);
                        var novoSubVideo = document.getElementById("main");
                        var vId = dataJSON.items[i].snippet.resourceId.videoId;

                        novoSubVideo.innerHTML += (
                        '<article class="item" id="'+i+'" data-key='+vId+'>'+
                            '<div class="titulo-thumb">'+
                                '<img src="'+ thumbnail +'" alt="" class="thumb">' +
                                '<h4>'+title+'</h4>'+
                            '</div>'+
                            '<div class="details hidden">'+
                                '<section class="js-video">' +
                                    '<iframe class="iframe-video" width=100% height="315" src="https://www.youtube.com/embed/'+vId+'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>' +
                                '</section>' +
                                '<p>'+descript+'</p>'+
                            
                            '</div>'+
                        '</article>');

                    }

                    var subVideos = document.getElementsByClassName("item");
                    var playerVid = document.getElementsByClassName("details");


                    //Função que define a resposta ao click agora está 100%
                    var clickReply = function(e) {
                        var vidId = this.getAttribute("data-key");
                        //mainVid(vidId);
                        console.log(this);
                        //console.log(e.target.parentElement);
                        //console.log(this == e.target.parentElement)
                        /*definição da função que faz o accordion(collapsable)*/
                        if (this.lastChild.classList.value.includes('active')) { 
                            removeClass(this.lastChild, "active");
                            addClass(this.lastChild, "hidden");

                        } else {
                            removeClass(this.lastChild, "hidden");
                            addClass(this.lastChild, "active");
                        };
                        for (var i = 0; i < subVideos.length; i++) { // garante q só a clicada por ultimo vai estar visivel
                            if(subVideos[i] != this){
                                removeClass(subVideos[i].lastChild, "active");
                                addClass(subVideos[i].lastChild, "hidden");
                            }
                        }; 
                        //alert(vidId);
                    };

                    for (var i = 0; i < subVideos.length; i++) { // loop que adiciona o evento de click
                        subVideos[i].addEventListener('click', clickReply);
                    }
                    
                 }

             </script>

       </main>
   </div> 

   <script src="../js/navBarJS.js"> </script>
</body>
</html>